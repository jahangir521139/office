---
- name: Gather OS info
  hosts: all
  gather_facts: true
  tasks:
    - name: Get last Windows Update
      win_shell: |
        Get-HotFix | Sort-Object -Property InstalledOn -Descending | Select-Object -First 1
      register: win_updates
      
    - name: Collect OS info in a fact
      set_fact:
        os_info_report: |
          Host: {{ inventory_hostname }}
          OS: {{ ansible_distribution }} {{ ansible_distribution_version }}
          Kernel: {{ ansible_kernel }}
          Architecture: {{ ansible_architecture }}
          Hostname: {{ ansible_hostname }}
          Last Update: {{ win_updates.stdout }}
